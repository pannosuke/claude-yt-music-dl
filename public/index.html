<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Tools - Download & Organize</title>

    <!-- Shared CSS -->
    <link rel="stylesheet" href="/css/shared.css">
    <link rel="stylesheet" href="/css/downloader.css">
    <link rel="stylesheet" href="/css/organizer.css">
</head>
<body>
    <div class="app-container">
        <!-- Tab Navigation -->
        <nav class="tab-nav">
            <button class="tab-button" data-route="downloader" onclick="router.navigate('downloader')">
                <span class="tab-icon">‚¨áÔ∏è</span>
                <span class="tab-label">YouTube Downloader</span>
            </button>
            <button class="tab-button" data-route="organizer" onclick="router.navigate('organizer')">
                <span class="tab-icon">üìÅ</span>
                <span class="tab-label">Music Organizer</span>
            </button>
        </nav>

        <!-- Module 1: YouTube Music Downloader -->
        <div id="module-downloader" class="module-container">
            <h1>YouTube Music Downloader</h1>
            <p class="subtitle">Download playlists in FLAC format, organized by artist and album</p>

            <div class="info-box">
                <strong>Requirements:</strong> Make sure <code>yt-dlp</code> is installed on your system.<br>
                Install with: <code>pip install yt-dlp</code>
            </div>

            <form id="downloadForm">
                <div class="form-group">
                    <label for="playlistUrl">YouTube Music Playlist URL *</label>
                    <input
                        type="text"
                        id="playlistUrl"
                        name="playlistUrl"
                        value=""
                        placeholder="https://music.youtube.com/playlist?list=..."
                        required
                    >
                </div>

                <div class="form-group">
                    <label for="outputPath">Output Directory Path *</label>
                    <input
                        type="text"
                        id="outputPath"
                        name="outputPath"
                        value=""
                        placeholder="/path/to/music/directory"
                        required
                    >
                    <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                        Enter the full path where you want to save the music files
                    </small>
                </div>

                <div class="form-group">
                    <label for="cookiesPath">Cookies File Path</label>
                    <input
                        type="text"
                        id="cookiesPath"
                        name="cookiesPath"
                        value=""
                        placeholder="/path/to/cookies.txt (optional)"
                    >
                    <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                        Path to your cookies.txt file for authentication
                    </small>
                </div>

                <div class="form-group">
                    <label for="poToken">PO Token</label>
                    <input
                        type="text"
                        id="poToken"
                        name="poToken"
                        value=""
                        placeholder="Your PO token (optional)"
                    >
                </div>

                <div class="button-group">
                    <button type="submit" id="downloadBtn">Start Download</button>
                    <button type="button" id="cancelBtn" class="button-cancel" style="display: none;">Cancel Download</button>
                </div>
            </form>

            <div class="progress-container" id="progressContainer">
                <!-- Statistics Cards -->
                <div class="stats-grid">
                    <div class="stat-card total">
                        <div class="label">Total Tracks</div>
                        <div class="value" id="totalTracks">--</div>
                    </div>
                    <div class="stat-card completed">
                        <div class="label">Completed</div>
                        <div class="value" id="completedTracks">0</div>
                    </div>
                    <div class="stat-card remaining">
                        <div class="label">Remaining</div>
                        <div class="value" id="remainingTracks">--</div>
                    </div>
                    <div class="stat-card failed">
                        <div class="label">Failed</div>
                        <div class="value" id="failedTracks">0</div>
                    </div>
                </div>

                <!-- Current Track Card -->
                <div class="current-track-card" id="currentTrackCard">
                    <h3>Currently Downloading</h3>
                    <div class="track-info">
                        <div class="track-info-row">
                            <span class="track-info-label">Artist:</span>
                            <span class="track-info-value" id="currentArtist">--</span>
                        </div>
                        <div class="track-info-row">
                            <span class="track-info-label">Album:</span>
                            <span class="track-info-value" id="currentAlbum">--</span>
                        </div>
                        <div class="track-title" id="currentTitle">Initializing...</div>
                        <div style="margin-top: 10px;">
                            <span class="format-badge" id="formatBadge">FLAC</span>
                        </div>
                    </div>
                    <div class="file-progress-bar-bg">
                        <div class="file-progress-bar" id="fileProgressBar"></div>
                    </div>
                </div>

                <!-- Errors Panel -->
                <div class="errors-panel" id="errorsPanel">
                    <h4 onclick="this.nextElementSibling.style.display = this.nextElementSibling.style.display === 'none' ? 'block' : 'none'">
                        ‚ö†Ô∏è Issues Detected (Click to expand)
                    </h4>
                    <div class="error-list" id="errorList" style="display: none;"></div>
                </div>

                <!-- Overall Progress -->
                <div class="overall-progress-section">
                    <h3>Overall Progress</h3>
                    <div class="progress-text" id="progressText">Initializing...</div>
                    <div class="progress-bar-bg">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                </div>

                <!-- Debug Log -->
                <div class="log-container" id="logContainer"></div>
            </div>
        </div>

        <!-- Module 2: Music Library Organizer -->
        <div id="module-organizer" class="module-container">
            <h1>Music Library Organizer</h1>
            <p class="subtitle">Organize your music library for optimal Plex Media Server compatibility</p>

            <div class="info-box">
                <strong>What this does:</strong> Scans your music folder, identifies incorrect organization,
                and renames/moves files to match Plex standards using MusicBrainz database.<br>
                <strong>Supports:</strong> Western and Japanese music databases
            </div>

            <!-- Scan Form -->
            <form id="scanForm">
                <div class="form-group">
                    <label for="musicPath">Music Library Path *</label>
                    <input
                        type="text"
                        id="musicPath"
                        name="musicPath"
                        value=""
                        placeholder="/path/to/music/library"
                        required
                    >
                    <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                        Enter the full path to your music library root folder
                    </small>
                </div>

                <button type="submit" id="scanBtn">Scan Library</button>
            </form>

            <!-- Progress Container -->
            <div class="progress-container" id="scanProgressContainer">
                <div class="progress-text" id="scanProgressText">Initializing scan...</div>
                <div class="progress-bar-bg">
                    <div class="progress-bar" id="scanProgressBar"></div>
                </div>
                <div class="log-container" id="scanLogContainer"></div>
            </div>

            <!-- Scan Results -->
            <div class="scan-results" id="scanResults">
                <div class="results-header">
                    <h2>Scan Results</h2>
                    <div class="result-actions">
                        <button type="button" id="newScanBtn">New Scan</button>
                    </div>
                </div>

                <!-- Summary Cards -->
                <div class="summary-grid">
                    <div class="summary-card total">
                        <div class="label">Total Files</div>
                        <div class="value" id="summaryTotalFiles">--</div>
                    </div>
                    <div class="summary-card compliant">
                        <div class="label">Plex Compliant</div>
                        <div class="value" id="summaryCompliantFiles">--</div>
                    </div>
                    <div class="summary-card needs-fix">
                        <div class="label">Needs Fix</div>
                        <div class="value" id="summaryNeedsFix">--</div>
                    </div>
                    <div class="summary-card artists">
                        <div class="label">Artists</div>
                        <div class="value" id="summaryArtists">--</div>
                    </div>
                    <div class="summary-card albums">
                        <div class="label">Albums</div>
                        <div class="value" id="summaryAlbums">--</div>
                    </div>
                </div>

                <!-- Issues Breakdown -->
                <div class="issues-breakdown" id="issuesBreakdown" style="display: none;">
                    <h4>Issues Found</h4>
                    <div id="issuesList"></div>
                </div>

                <!-- Format Distribution -->
                <div style="margin-bottom: 20px;">
                    <h3 style="font-size: 14px; margin-bottom: 10px;">Audio Formats</h3>
                    <div class="format-list" id="formatList"></div>
                </div>

                <!-- Alphabetical Groups -->
                <div class="artist-groups" id="artistGroups">
                    <h3>Artists Grouped Alphabetically</h3>
                    <div class="group-grid" id="groupGrid"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript modules -->
    <script src="/js/router.js"></script>
    <script src="/js/downloader.js"></script>
    <script src="/js/organizer.js"></script>
</body>
</html>
