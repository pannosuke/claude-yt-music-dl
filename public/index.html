<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Tools - Download & Organize</title>

    <!-- Shared CSS -->
    <link rel="stylesheet" href="/css/shared.css">
    <link rel="stylesheet" href="/css/downloader.css">
    <link rel="stylesheet" href="/css/organizer.css">
</head>
<body>
    <div class="app-container">
        <!-- Tab Navigation -->
        <nav class="tab-nav">
            <button class="tab-button" data-route="downloader" onclick="router.navigate('downloader')">
                <span class="tab-icon">‚¨áÔ∏è</span>
                <span class="tab-label">YouTube Downloader</span>
            </button>
            <button class="tab-button" data-route="organizer" onclick="router.navigate('organizer')">
                <span class="tab-icon">üìÅ</span>
                <span class="tab-label">Music Organizer</span>
            </button>
        </nav>

        <!-- Module 1: YouTube Music Downloader -->
        <div id="module-downloader" class="module-container">
            <h1>YouTube Music Downloader</h1>
            <p class="subtitle">Download playlists in FLAC format, organized by artist and album</p>

            <div class="info-box">
                <strong>Requirements:</strong> Make sure <code>yt-dlp</code> is installed on your system.<br>
                Install with: <code>pip install yt-dlp</code>
            </div>

            <form id="downloadForm">
                <div class="form-group">
                    <label for="playlistUrl">YouTube Music Playlist URL *</label>
                    <input
                        type="text"
                        id="playlistUrl"
                        name="playlistUrl"
                        value=""
                        placeholder="https://music.youtube.com/playlist?list=..."
                        required
                    >
                </div>

                <div class="form-group">
                    <label for="outputPath">Output Directory Path *</label>
                    <input
                        type="text"
                        id="outputPath"
                        name="outputPath"
                        value=""
                        placeholder="/path/to/music/directory"
                        required
                    >
                    <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                        Enter the full path where you want to save the music files
                    </small>
                </div>

                <div class="form-group">
                    <label for="cookiesPath">Cookies File Path</label>
                    <input
                        type="text"
                        id="cookiesPath"
                        name="cookiesPath"
                        value=""
                        placeholder="/path/to/cookies.txt (optional)"
                    >
                    <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                        Path to your cookies.txt file for authentication
                    </small>
                </div>

                <div class="form-group">
                    <label for="poToken">PO Token</label>
                    <input
                        type="text"
                        id="poToken"
                        name="poToken"
                        value=""
                        placeholder="Your PO token (optional)"
                    >
                </div>

                <div class="button-group">
                    <button type="submit" id="downloadBtn">Start Download</button>
                    <button type="button" id="cancelBtn" class="button-cancel" style="display: none;">Cancel Download</button>
                </div>
            </form>

            <div class="progress-container" id="progressContainer">
                <!-- Statistics Cards -->
                <div class="stats-grid">
                    <div class="stat-card total">
                        <div class="label">Total Tracks</div>
                        <div class="value" id="totalTracks">--</div>
                    </div>
                    <div class="stat-card completed">
                        <div class="label">Completed</div>
                        <div class="value" id="completedTracks">0</div>
                    </div>
                    <div class="stat-card remaining">
                        <div class="label">Remaining</div>
                        <div class="value" id="remainingTracks">--</div>
                    </div>
                    <div class="stat-card failed">
                        <div class="label">Failed</div>
                        <div class="value" id="failedTracks">0</div>
                    </div>
                </div>

                <!-- Current Track Card -->
                <div class="current-track-card" id="currentTrackCard">
                    <h3>Currently Downloading</h3>
                    <div class="track-info">
                        <div class="track-info-row">
                            <span class="track-info-label">Artist:</span>
                            <span class="track-info-value" id="currentArtist">--</span>
                        </div>
                        <div class="track-info-row">
                            <span class="track-info-label">Album:</span>
                            <span class="track-info-value" id="currentAlbum">--</span>
                        </div>
                        <div class="track-title" id="currentTitle">Initializing...</div>
                        <div style="margin-top: 10px;">
                            <span class="format-badge" id="formatBadge">FLAC</span>
                        </div>
                    </div>
                    <div class="file-progress-bar-bg">
                        <div class="file-progress-bar" id="fileProgressBar"></div>
                    </div>
                </div>

                <!-- Errors Panel -->
                <div class="errors-panel" id="errorsPanel">
                    <h4 onclick="this.nextElementSibling.style.display = this.nextElementSibling.style.display === 'none' ? 'block' : 'none'">
                        ‚ö†Ô∏è Issues Detected (Click to expand)
                    </h4>
                    <div class="error-list" id="errorList" style="display: none;"></div>
                </div>

                <!-- Overall Progress -->
                <div class="overall-progress-section">
                    <h3>Overall Progress</h3>
                    <div class="progress-text" id="progressText">Initializing...</div>
                    <div class="progress-bar-bg">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                </div>

                <!-- Debug Log -->
                <div class="log-container" id="logContainer"></div>
            </div>
        </div>

        <!-- Module 2: Music Library Organizer -->
        <div id="module-organizer" class="module-container">
            <h1>Music Library Organizer</h1>
            <p class="subtitle">Organize your music library for optimal Plex Media Server compatibility</p>

            <div class="info-box">
                <strong>What this does:</strong> Scans your music folder, identifies incorrect organization,
                and renames/moves files to match Plex standards using MusicBrainz database.<br>
                <strong>Supports:</strong> Western and Japanese music databases
            </div>

            <!-- Scan Form -->
            <form id="scanForm">
                <div class="form-group">
                    <label for="musicPath">Music Library Path *</label>
                    <input
                        type="text"
                        id="musicPath"
                        name="musicPath"
                        value=""
                        placeholder="e.g., /Users/yourname/Music or C:\Users\yourname\Music"
                        required
                    >
                    <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                        üí° Tip: You can drag a folder from Finder/Explorer into this field, or copy/paste the path
                    </small>
                </div>

                <div class="button-group">
                    <button type="submit" id="scanBtn">Scan Library</button>
                    <button type="button" id="cancelScanBtn" class="button-cancel" style="display: none;">Cancel Scan</button>
                </div>
            </form>

            <!-- Progress Container -->
            <div class="progress-container" id="scanProgressContainer">
                <div class="progress-text" id="scanProgressText">Initializing scan...</div>
                <div class="progress-bar-bg">
                    <div class="progress-bar" id="scanProgressBar"></div>
                </div>
                <div class="log-container" id="scanLogContainer"></div>
            </div>

            <!-- Scan Results -->
            <div class="scan-results" id="scanResults">
                <div class="results-header">
                    <h2>Scan Results</h2>
                    <div class="result-actions">
                        <button type="button" id="newScanBtn">New Scan</button>
                    </div>
                </div>

                <!-- Summary Cards -->
                <div class="summary-grid">
                    <div class="summary-card total">
                        <div class="label">Total Files</div>
                        <div class="value" id="summaryTotalFiles">--</div>
                    </div>
                    <div class="summary-card compliant">
                        <div class="label">Plex Compliant</div>
                        <div class="value" id="summaryCompliantFiles">--</div>
                    </div>
                    <div class="summary-card needs-fix">
                        <div class="label">Needs Fix</div>
                        <div class="value" id="summaryNeedsFix">--</div>
                    </div>
                    <div class="summary-card artists">
                        <div class="label">Artists</div>
                        <div class="value" id="summaryArtists">--</div>
                    </div>
                    <div class="summary-card albums">
                        <div class="label">Albums</div>
                        <div class="value" id="summaryAlbums">--</div>
                    </div>
                </div>

                <!-- Issues Breakdown -->
                <div class="issues-breakdown" id="issuesBreakdown" style="display: none;">
                    <h4>Issues Found</h4>
                    <div id="issuesList"></div>
                </div>

                <!-- Format Distribution -->
                <div style="margin-bottom: 20px;">
                    <h3 style="font-size: 14px; margin-bottom: 10px;">Audio Formats</h3>
                    <div class="format-list" id="formatList"></div>
                </div>

                <!-- Alphabetical Groups -->
                <div class="artist-groups" id="artistGroups">
                    <h3>Artists Grouped Alphabetically</h3>
                    <p style="font-size: 12px; color: #666; margin-bottom: 15px;">
                        Click letter groups to select them for deep scanning
                    </p>
                    <div class="group-grid" id="groupGrid"></div>

                    <!-- Deep Scan Buttons -->
                    <div class="button-group" style="margin-top: 20px; display: none;" id="deepScanButtons">
                        <button type="button" id="deepScanSelectedBtn" class="button-primary" style="display: none;">
                            Deep Scan Selected
                        </button>
                        <button type="button" id="deepScanAllBtn" class="button-secondary" style="display: none;">
                            Deep Scan All
                        </button>
                    </div>
                </div>
            </div>

            <!-- Plex Integration Section -->
            <div class="plex-section" id="plexSection" style="display: none;">
                <div class="section-header">
                    <h2>üé¨ Plex Media Server Integration</h2>
                    <p class="subtitle">Compare your offline library with your Plex Media Server to prevent duplicates and downgrades</p>
                </div>

                <!-- Plex Connection Settings -->
                <div class="plex-connection-panel">
                    <h3>Plex Server Connection</h3>
                    <form id="plexConnectForm">
                        <div class="form-group">
                            <label for="plexServerIp">Server IP Address *</label>
                            <input
                                type="text"
                                id="plexServerIp"
                                name="plexServerIp"
                                value=""
                                placeholder="192.168.1.100 or plex.local"
                                required
                            >
                        </div>

                        <div class="form-group">
                            <label for="plexPort">Port *</label>
                            <input
                                type="text"
                                id="plexPort"
                                name="plexPort"
                                value="32400"
                                placeholder="32400"
                                required
                            >
                        </div>

                        <div class="form-group">
                            <label for="plexToken">X-Plex-Token *</label>
                            <input
                                type="password"
                                id="plexToken"
                                name="plexToken"
                                value=""
                                placeholder="Your Plex authentication token"
                                required
                            >
                            <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                                Find your token: Settings ‚Üí Account ‚Üí Authorized Devices ‚Üí Show XML ‚Üí Copy the "token" value
                            </small>
                        </div>

                        <div class="button-group">
                            <button type="submit" id="plexConnectBtn">Test Connection</button>
                        </div>
                    </form>

                    <div class="connection-status" id="connectionStatus" style="display: none;"></div>
                </div>

                <!-- Plex Library Selection -->
                <div class="plex-library-panel" id="plexLibraryPanel" style="display: none;">
                    <h3>Select Music Library</h3>
                    <div id="libraryList" class="library-list"></div>

                    <div class="button-group" style="margin-top: 20px;">
                        <button type="button" id="fetchLibraryBtn" style="display: none;">Fetch Library Tracks</button>
                    </div>
                </div>

                <!-- Plex Fetch Progress -->
                <div class="plex-progress-container" id="plexProgressContainer" style="display: none;">
                    <h3>Fetching Plex Library</h3>
                    <div class="progress-text" id="plexProgressText">Initializing...</div>
                    <div class="progress-bar-bg">
                        <div class="progress-bar" id="plexProgressBar"></div>
                    </div>
                </div>

                <!-- Comparison Results -->
                <div class="comparison-results" id="comparisonResults" style="display: none;">
                    <h3>Comparison Results</h3>

                    <!-- Summary Statistics -->
                    <div class="comparison-stats-grid">
                        <div class="comparison-stat-card safe">
                            <div class="label">Safe to Add</div>
                            <div class="value" id="statSafeToAdd">0</div>
                            <div class="desc">New tracks not in Plex</div>
                        </div>
                        <div class="comparison-stat-card upgrade">
                            <div class="label">Quality Upgrades</div>
                            <div class="value" id="statUpgrades">0</div>
                            <div class="desc">Better quality than Plex</div>
                        </div>
                        <div class="comparison-stat-card downgrade">
                            <div class="label">Quality Downgrades</div>
                            <div class="value" id="statDowngrades">0</div>
                            <div class="desc">Worse quality than Plex</div>
                        </div>
                        <div class="comparison-stat-card duplicate">
                            <div class="label">Same Quality Duplicates</div>
                            <div class="value" id="statDuplicates">0</div>
                            <div class="desc">Already in Plex (same quality)</div>
                        </div>
                    </div>

                    <!-- Detailed Conflicts Table -->
                    <div class="conflicts-panel">
                        <h4>Detailed Track Analysis</h4>
                        <div class="filter-buttons">
                            <button class="filter-btn active" data-filter="all">All</button>
                            <button class="filter-btn" data-filter="SAFE_TO_ADD">Safe to Add</button>
                            <button class="filter-btn" data-filter="QUALITY_UPGRADE">Upgrades</button>
                            <button class="filter-btn" data-filter="QUALITY_DOWNGRADE">Downgrades</button>
                            <button class="filter-btn" data-filter="SAME_QUALITY_DUPLICATE">Duplicates</button>
                        </div>
                        <div class="conflicts-table-container">
                            <table class="conflicts-table" id="conflictsTable">
                                <thead>
                                    <tr>
                                        <th>Artist</th>
                                        <th>Album</th>
                                        <th>Title</th>
                                        <th>Offline Quality</th>
                                        <th>Plex Quality</th>
                                        <th>Status</th>
                                        <th>Recommendation</th>
                                    </tr>
                                </thead>
                                <tbody id="conflictsTableBody">
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <div class="button-group" style="margin-top: 20px;">
                        <button type="button" id="exportReportBtn">Export Report (CSV)</button>
                        <button type="button" id="newComparisonBtn">New Comparison</button>
                    </div>
                </div>
            </div>

            <!-- MusicBrainz Integration (Phase 3) -->
            <div id="musicbrainzSection" class="results-section" style="display: none; margin-top: 30px;">
                <h2>üéµ MusicBrainz Metadata Search</h2>

                <div class="card">
                    <h3>Artist Search</h3>
                    <form id="mbArtistSearchForm" class="form-inline">
                        <input type="text" id="mbArtistInput" placeholder="Enter artist name..." required>
                        <button type="submit">Search Artist</button>
                    </form>
                    <div id="mbArtistResults" class="mb-results"></div>
                </div>

                <div class="card">
                    <h3>Release (Album) Search</h3>
                    <form id="mbReleaseSearchForm" class="form-inline">
                        <input type="text" id="mbReleaseArtistInput" placeholder="Artist name..." required>
                        <input type="text" id="mbReleaseAlbumInput" placeholder="Album name..." required>
                        <button type="submit">Search Release</button>
                    </form>
                    <div id="mbReleaseResults" class="mb-results"></div>
                </div>

                <div class="card">
                    <h3>Recording (Track) Search</h3>
                    <form id="mbRecordingSearchForm" class="form-inline">
                        <input type="text" id="mbRecordingArtistInput" placeholder="Artist name..." required>
                        <input type="text" id="mbRecordingAlbumInput" placeholder="Album name..." required>
                        <input type="text" id="mbRecordingTitleInput" placeholder="Track title..." required>
                        <button type="submit">Search Recording</button>
                    </form>
                    <div id="mbRecordingResults" class="mb-results"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript modules -->
    <script src="/js/router.js"></script>
    <script src="/js/downloader.js"></script>
    <script src="/js/organizer.js"></script>
</body>
</html>
